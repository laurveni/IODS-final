---
title: "Human development data"
author: "Laura Venieri, email: laura.venieri@helsinki.fi"
date: December 10, 2017
output: 
  html_document:
    theme: flatly
    toc: true
    toc_depth: 2
    fig_caption: true
    fig_width: 8
    fig_height: 6
    code_folding: hide
---

## Abstract

We analyse data related to the development of a country and investigate the relation between the Gross National Income (GNI) per capita, the life expectancy and the expected years of education. A high GNI per capita corresponds to high life expectancy and a longer education.

## Research questions

What can we say about the relation between the Gross National Income (GNI) per capita of a country and the life expectancy of its people? It seems quite natural to believe that a lower GNI per capita would correspond to a lower life expectancy. 

What about the relation between the GNI per capita and the expected years of education? Also in this case, one expects that people living in countries with low GNI have fewer years of education.

We will investigate weather these relationships are linear and weather we can say something else about them.

## Data

The 'human' dataset originates from the United Nations Development Programme. For more information see [their data page](http://hdr.undp.org/en/content/human-development-index-hdi) and the [technical notes](http://hdr.undp.org/sites/default/files/hdr2015_technical_notes.pdf) about calculating the human development indices.

The variable names in the data have been shortened, two new variables have been computed and only part of the original variables was kept. The data wrangling was done in [this script](https://github.com/laurveni/IODS-final/blob/master/data_wrangling_human.R).

Let us look at the structure of our data set, which now contains 155 obsservations of  8 variables.

```{r}
human_ <- read.csv(file="human.csv")
str(human_)
```

The row names are defined as the names of the countries. The variables are the following:

* "sedu_ratio" = Ratio of females/males with at least secondary education
* "lab_ratio" = Ratio of females/males in the labour force
* "life_exp" = Life expectancy at birth
* "exp_edu" = Expected years of schooling 
* "gni_c" = Gross National Income per capita
* "mat_mort" = Maternal mortality ratio
* "ad_birth" = Adolescent birth rate
* "repr_parl" = Percetange of female representatives in parliament

We now visualize an overview of the data and the correlation matrix to get some insight on the relationships between the variables.

```{r message=FALSE}
library(GGally)
library(dplyr)
library(corrplot)
# visualize the 'human_' variables
ggpairs(human_)

# compute the correlation matrix and visualize it with corrplot
cor(human_) %>% corrplot
```

As we had predicted, there is a quite strong positive correlation between the GNI per capita (gni_c), the life expectancy (life_exp) and the expected years of education (exp_edu). Let us now dig more into this.

## Methods

To analyse the data we will use two methods:

* Linear regression

* K-means

**First method: Linear regression**

*Description of the method*

Given a certain number of variables, a regression model assumes that the relationship between the dependent variable y (called target) and the explanatory variables is linear. Since we will use two explanatory variables, we explain this case and call them x,z. The model takes the form

y= ax+by+e,

where a and b are the coefficients and e is the error term or noise, an unobservable random variable. The goal is to estimate the parameters a and b. The assumptions of the method are the following:

* The errors are normally distributed
* The errors are not correlated
* The errors have constant variance
* The size of a given error does not depend on the explanatory variables.


*Fitting a linear regression model to our data*

We now fit a regression model with gni_c as the target and life_exp and exp_edu as the explanatory variables. Here is a summary of the model.

```{r message=FALSE}
#linear regression model
my_model <- lm(gni_c ~ life_exp + exp_edu, data = human_)
summary(my_model)
```

The p-values of both explanatory variables are very low so they have a statistically significant relation with the Gross National Income per capita. The multiple R-squared of the model is 43.7%, which is quite high.

```{r message=FALSE}
par(mfrow = c(2,2))
plot(my_model, which=c(1,2,5))
```

In the Residuals vs Fitted plot the points are not very scattered so the size of the errors may depend on the explanatory variables. This means that the assumption that the variance is constant might not be reasonable. In the Normal QQ-plot we can observe that there is a quite good fit to the line so the assumption that the errors of the model are normally distributed is reasonable. The Residuals vs Leverage plot shows that there are a few values with higher leverage, so there a few observations may have unusually high impact.

**Second method: K-means**

*Description of the method*

K-means is a clustering method that aims to partition the given observations into k clusters in which each observation belongs to the cluster with the nearest mean. One first chooses the number of clusters and picks initial cluster centroids, then the algorithm calculates the distances between the centroids and the observations and assigns the observation to the cluster with the closest centroid. It then calculates the new centroids and repeats the previous steps until the centroids or the clusters do not change.

Using different distances one can obtain different results, here we will use the Euclidean distance. One way to determine the optimal number of clusters is looking at the total within cluster sum of squares, which is the sum over every cluster of the following quantity:

(x_1 - centroid)^2+ ... (x_N - centroid)^2.

Looking at the plot of the number of clusters and the total within cluster sum of squares, the optimal number of clusters is that corresponding to a quick drop in the total WCSS.

*Applying K-means to our data*

We now standardize the dataset, scaling the variables to get comparable distances. We display a summary of the Euclidean distances between the observations. 

```{r}
#scale the variables
human_s <- scale(human_)
human_s <- as.data.frame(human_s)
# euclidean distance matrix
dist_eu <- dist(human_s)
# look at the summary of the distances
summary(dist_eu)
```


To investigate what is the optimal number of clusters, we look at how the total of within cluster sum of squares (twcss) behaves when the number of clusters changes. Looking at the following plot two clusters seem to be optimal.


```{r}
library(ggplot2)
set.seed(123)

# determine the number of clusters
k_max <- 10
# calculate the total within sum of squares
twcss <- sapply(1:k_max, function(k){kmeans(human_s, k)$tot.withinss})
# visualize the results
qplot(x = 1:k_max, y = twcss, geom = 'line')
```

We now run the K-means algorithm with two clusters and visualize the clusters in the same variables.

```{r}
library(GGally)
# k-means clustering with 2 clusters
km <-kmeans(human_s, centers = 2)
# plot the boston_s dataset with clusters
pairs(human_s,col = km$cluster)
```

Some of the clusters seem quite accurate, such as those related to the variable gni_c (divided into low and high Gross National Income per capita). It seems quite clear that a lower Gross National Income per capita corresponds to a lower life expectancy and fewer expected years of education.

## Conclusions

There is certainly a positive correlation between the GNI per capita and the life expectancy, as well as between the GNI per capita and the expected years of education. We cannot say that it is really linear, since the results obtained with the linear regression model are good but the validation suggests that some assumptions of the method are not reasonable. 